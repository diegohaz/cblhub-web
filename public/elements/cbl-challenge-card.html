<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">

<link rel="import" href="cbl-app-styles.html">
<link rel="import" href="cbl-icons.html">
<link rel="import" href="cbl-keyword-list.html">

<dom-module id="cbl-challenge-card">
  <template>
    <style include="cbl-app-styles">
      :host {
        display: block;
        background: #fff;
        box-sizing: border-box;
      }

      :host > * {
        padding: 8px;
      }

      .link {
        @apply(--layout-fit);
        z-index: 98;
      }

      .link:hover + .header iron-image {
        transform: scale(1.2);
      }

      .header {
        position: relative;
        overflow: hidden;
        height: 250px;
        color: #fff;
        padding: 0;
      }

      .header iron-image {
        width: 100%;
        height: 100%;
        background-color: #212121;
        transition: transform 500ms;
      }

      .header:after {
        content: '';
        background-image: linear-gradient(to top, rgba(0,0,0,.9), rgba(0,0,0,0) 50%, rgba(0,0,0,0) 80%, rgba(0,0,0,.6));
        @apply(--layout-fit);
      }

      .header .big-idea {
        position: absolute;
        top: 0;
        padding: 16px;
        font-size: 18px;
        font-weight: 400;
      }

      .header .big-idea a {
        position: relative;
        color: #fff;
        z-index: 99;
      }

      .header .title {
        position: absolute;
        bottom: 0px;
        padding: 16px;
        font-size: 24px;
        font-weight: 400;
        z-index: 2;
      }

      .info {
        font-size: 12px;
        padding-bottom: 4px;
        color: var(--secondary-text-color);
        @apply(--layout-horizontal);
      }

      .info .date {
        @apply(--layout-flex);
      }

      .info .contributions {
        @apply(--layout-horizontal);
        @apply(--layout-center);
      }

      .info iron-icon {
        width: 12px;
        height: 12px;
        margin-right: 4px;
      }
    </style>

    <a class="link"
      href="/challenges/[[challenge.id]]"
      data-path$="/challenges/[[challenge.id]]"
      state="[[challenge]]"
      aria-label$="[[challenge.title]], [[date]]"
      on-tap="go">
    </a>

    <div class="header">
      <iron-image src="[[challenge.photo.medium.src]]" sizing="cover" preload fade></iron-image>
      <div class="big-idea"><a href="/search/[[challenge.bigIdea]]">[[challenge.bigIdea]]</a></div>
      <div class="title">[[challenge.title]]</div>
    </div>

    <div class="info">
      <div class="date">[[_computeDate(challenge)]]</div>
      <div class="contributions">
        <iron-icon icon="cbl:contributions"></iron-icon>
        <span>[[_computeContributions(challenge)]] contrib.</span>
      </div>
    </div>

    <div class="essential-question">[[challenge.essentialQuestion]]</div>

    <cbl-keyword-list keywords="[[_computeKeywords(challenge.keywords)]]"></cbl-keyword-list>
  </template>
  <script>
    Polymer({
      is: 'cbl-challenge-card',

      behaviors: [
        CBLAppBehavior
      ],

      properties: {
        challenge: {
          type: Object,
          value: {}
        }
      },

      _computeDate: function(challenge) {
        if (challenge.updatedAt === undefined) return;

        if (challenge.updatedAt.getTime() == challenge.createdAt.getTime()) {
          return 'created ' + moment(challenge.createdAt).fromNow();
        } else {
          return 'updated ' + moment(challenge.updatedAt).fromNow();
        }
      },

      _computeContributions: function(challenge) {
        if (challenge.questions === undefined) return;

        return challenge.questions + challenge.activities + challenge.resources;
      },

      _computeKeywords: function(keywords) {
        if (keywords === undefined) return;

        return keywords.slice(0, 3);
      }
    });
  </script>
</dom-module>