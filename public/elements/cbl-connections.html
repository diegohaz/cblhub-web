<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">

<link rel="import" href="cbl-icons.html">

<dom-module id="cbl-connections">
  <template>
    <style>
      :host {
        display: block;
      }

      .middle-line {
        height: 88px;
        width: 0;
        border: 1px solid var(--primary-color);
        margin: 0 auto;
      }

      .outer-line {
        height: 44px;
        width: calc(100%/3*2);
        border: 2px solid var(--primary-color);
        border-radius: 10px 10px 0 0;
        border-bottom-width: 0 !important;
        margin: -46px auto 0;
      }

      .guides {
        width: 100%;
        @apply(--layout-horizontal);
      }

      .guides > div {
        width: calc(100%/3);
        padding: 0 8px;
        box-sizing: border-box;
        @apply(--layout-vertical);
        @apply(--layout-center);
        height: 1000px;
      }

      .guides iron-icon {
        color: var(--primary-color);
        width: 40px;
        height: 40px;
      }

      .action {
        background-color: #fff;
        width: 100%;
        padding: 8px;
        margin: 8px;
        box-sizing: border-box;
      }

      paper-dropdown-menu ::content iron-dropdown {
        top: auto !important;
      }

    </style>

    <div class="middle-line"></div>
    <div class="outer-line"></div>

    <div class="guides">
      <template is="dom-repeat" items="[[guides]]" as="guide">
        <div class="[[guide.plural]]">
          <iron-icon icon="cbl:[[guide.singular]]"></iron-icon>

          <div class="action">
            <template is="dom-if" if="[[!editable]]">
              <form is="iron-form" id$="[[guide.singular]]Form">
                <paper-input label="[[guide.action]] [[guide.article]] [[guide.singular]]"></paper-input>
                <button hidden></button>
              </form>
            </template>
            <template is="dom-if" if="[[editable]]">
              <paper-dropdown-menu label="Add a related [[guide.singular]]">
                <paper-menu multi class="dropdown-content">
                  <template is="dom-repeat" items="[[_computeDropdownItems(challenge, guide.plural)]]">
                    <paper-item>[[item.title]]</paper-item>
                  </template>
                  <paper-item><paper-button>[[guide.action]] a new [[guide.singular]]</paper-button></paper-item>
                </paper-menu>
              </paper-dropdown-menu>
            </template>
          </div>
        </div>
      </template>
    </div>

  </template>
  <script>
    Polymer({
      is: 'cbl-connections',

      properties: {
        challenge: Object,
        guide: Object,
        verticalAlign: {
          type: String,
          value: 'bottom'
        },
        editable: {
          type: Boolean,
          value: false
        },
        guides: {
          type: Array,
          value: [{
            singular: 'question',
            plural: 'questions',
            action: 'Ask',
            article: 'a'
          },{
            singular: 'activity',
            plural: 'activities',
            action: 'Propose',
            article: 'an'
          },{
            singular: 'resource',
            plural: 'resources',
            action: 'Link',
            article: 'a'
          }]
        }
      },

      _computeDropdownItems: function(challenge, guide) {
        return challenge[guide];
      }
    });
  </script>
</dom-module>