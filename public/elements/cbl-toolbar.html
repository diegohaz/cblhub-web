<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">

<link rel="import" href="cbl-logo.html">
<link rel="import" href="cbl-search-bar.html">

<dom-module id="cbl-toolbar">
  <template>
    <style>
      :host {
        display: block;
        position: fixed;
        width: 100%;
        height: 64px;
        background: #fff;
        height: 64px;
        padding: 0 8px;
        pointer-events: none;
        box-sizing: border-box;
        @apply(--layout-horizontal);
        @apply(--layout-center);
      }

      :host > * {
        pointer-events: auto;
      }

      #title {
        margin: 0 8px 0 16px;
        width: 80px;
        white-space: nowrap;
      }

      cbl-search-bar {
        @apply(--layout-flex);
        margin: 0 8px 0 16px;
      }

      paper-menu-button {
        padding: 0;
      }

      paper-item {
        min-width: 120px;
        cursor: pointer;
      }

      @media (max-width: 600px) {
        :host {
          height: 56px;
        }
      }
    </style>

    <iron-media-query query="max-width: 600px" query-matches="{{mobile}}"></iron-media-query>

    <a href="/" id="title"><cbl-logo></cbl-logo></a>

    <template is="dom-if" if="[[!mobile]]">
      <cbl-search-bar query="{{query}}"></cbl-search-bar>

      <paper-button on-tap="go" data-path="/challenges/create" raised>
        <iron-icon icon="add"></iron-icon><span>Challenge</span>
      </paper-button>
    </template>

    <template is="dom-if" if="[[mobile]]">
      <div class="flex"></div>
      <paper-icon-button icon="search"></paper-icon-button>
    </template>

    <paper-menu-button horizontal-align="right">
      <paper-icon-button icon="more-vert" aria-label="More options" class="dropdown-trigger"></paper-icon-button>
      <paper-menu class="dropdown-content">
        <paper-item on-tap="_goLogIn" hidden="[[user]]">Log In</paper-item>
        <paper-item on-tap="_goSignUp" hidden="[[user]]">Sign Up</paper-item>
        <paper-item on-tap="_logOut" hidden="[[!user]]">Log Out</paper-item>
      </paper-menu>
    </paper-menu-button>
  </template>

  <script>
    Polymer({
      is: 'cbl-toolbar',

      behaviors: [CBLAppBehavior],

      hostAttributes: {
        'role': 'toolbar'
      },

      properties: {
        query: {
          type: String,
          notify: true
        }
      },

      _logOut: function() {
        Parse.User.logOut().then(function() {
          this.user = null;
          this.message = 'You have successfully logged out';
          this.go('/login');
        }.bind(this));
      },

      _goLogIn: function() {
        this.go('/login?back=' + this.path);
      },

      _goSignUp: function() {
        this.go('/signup?back=' + this.path);
      }
    });
  </script>
</dom-module>
